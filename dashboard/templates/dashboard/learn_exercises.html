{% extends "base.html" %} {% load static %} {% block content %}
<div class="exercise-container">
  <h1 class="exercise-title">Learn <span class="highlight">Exercises</span></h1>

  <div class="exercise-layout">
    <!-- Left column: Exercise search and results -->
    <div class="exercise-search-area">
      <div class="search-wrapper">
        <input
          type="text"
          id="exercise-search"
          placeholder="Search for exercises..." />
        <button id="search-button" class="search-btn">Search</button>
      </div>

      <div class="exercise-results" id="exercise-results">
        <!-- Exercise results will be displayed here -->
        <div class="initial-message">
          Search for exercises to see demonstrations and information
        </div>
      </div>
    </div>

    <!-- Right column: AI assistant chat -->
    <div class="chatbot-container">
      <div class="chatbot-header">
        <h3>Fitness Assistant</h3>
      </div>

      <div class="chat-messages" id="chat-messages">
        <div class="message bot">
          <div class="message-content">
            Hi there! I'm your FitJacket assistant. Ask me anything about
            exercises, workout routines, or fitness tips!
          </div>
        </div>
      </div>

      <div class="chat-input">
        <input
          type="text"
          id="user-message"
          placeholder="Ask about workouts..." />
        <button id="send-message" class="chat-btn">Send</button>
      </div>
    </div>
  </div>
</div>

<style>
  /* Exercise page specific styles */
  .exercise-container {
    padding: 30px 20px;
    max-width: 1200px;
    margin: 0 auto;
  }

  .exercise-title {
    font-size: 2.5rem;
    margin-bottom: 30px;
    text-align: center;
  }

  .exercise-layout {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
  }

  /* Exercise search area */
  .exercise-search-area {
    flex: 3;
    min-width: 300px;
    background-color: #111;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
  }

  .search-wrapper {
    display: flex;
    margin-bottom: 20px;
  }

  #exercise-search {
    flex: 1;
    padding: 12px 15px;
    border: none;
    background-color: #1e1e1e;
    color: #fff;
    border-radius: 5px 0 0 5px;
    font-size: 1rem;
  }

  .search-btn {
    background-color: #f8c424;
    color: #000;
    border: none;
    padding: 0 20px;
    border-radius: 0 5px 5px 0;
    font-weight: bold;
    cursor: pointer;
  }

  .exercise-results {
    min-height: 400px;
    max-height: 600px;
    overflow-y: auto;
    padding: 10px;
  }

  .initial-message {
    color: #888;
    text-align: center;
    margin-top: 100px;
  }

  .exercise-card {
    background-color: #1e1e1e;
    border-radius: 8px;
    margin-bottom: 15px;
    padding: 15px;
    display: flex;
    flex-direction: column;
    transition: transform 0.2s;
  }

  .exercise-card:hover {
    transform: translateY(-3px);
  }

  .exercise-name {
    font-size: 1.2rem;
    font-weight: bold;
    margin-bottom: 10px;
    color: #f8c424;
  }

  .exercise-details {
    display: flex;
    flex-wrap: wrap;
    margin-bottom: 10px;
  }

  .exercise-detail {
    background-color: #333;
    padding: 5px 10px;
    border-radius: 15px;
    margin-right: 8px;
    margin-bottom: 8px;
    font-size: 0.8rem;
  }

  .exercise-image {
    width: 100%;
    max-width: 300px;
    height: auto;
    margin: 10px auto;
    border-radius: 5px;
  }

  /* Chatbot styles */
  .chatbot-container {
    flex: 2;
    min-width: 250px;
    background-color: #111;
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    max-height: 600px;
  }

  .chatbot-header {
    background-color: #1a1a1a;
    padding: 15px;
    border-radius: 10px 10px 0 0;
    border-bottom: 1px solid #333;
  }

  .chatbot-header h3 {
    margin: 0;
    color: #f8c424;
  }

  .chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 15px;
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .message {
    display: flex;
    max-width: 80%;
  }

  .message.user {
    align-self: flex-end;
  }

  .message.bot {
    align-self: flex-start;
  }

  .message-content {
    padding: 10px 15px;
    border-radius: 18px;
    background-color: #1e1e1e;
  }

  .user .message-content {
    background-color: #2c4f9c;
    color: #fff;
    border-radius: 18px 18px 0 18px;
  }

  .bot .message-content {
    background-color: #333;
    color: #fff;
    border-radius: 18px 18px 18px 0;
  }

  .chat-input {
    padding: 15px;
    display: flex;
    border-top: 1px solid #333;
  }

  #user-message {
    flex: 1;
    padding: 12px 15px;
    border: none;
    background-color: #1e1e1e;
    color: #fff;
    border-radius: 5px 0 0 5px;
  }

  .chat-btn {
    background-color: #f8c424;
    color: #000;
    border: none;
    padding: 0 20px;
    border-radius: 0 5px 5px 0;
    font-weight: bold;
    cursor: pointer;
  }

  .loading-indicator {
    display: inline-block;
    width: 15px;
    height: 15px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: #f8c424;
    animation: spin 1s ease-in-out infinite;
    margin-right: 10px;
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }

  .error {
    color: #ff6b6b;
    text-align: center;
    margin-top: 20px;
  }

  .no-results {
    color: #aaa;
    text-align: center;
    margin-top: 20px;
  }

  .loading {
    color: #f8c424;
    text-align: center;
    margin-top: 20px;
  }

  @media (max-width: 768px) {
    .exercise-layout {
      flex-direction: column;
    }

    .exercise-search-area,
    .chatbot-container {
      width: 100%;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const searchInput = document.getElementById('exercise-search');
    const searchButton = document.getElementById('search-button');
    const resultsContainer = document.getElementById('exercise-results');
    const userMessageInput = document.getElementById('user-message');
    const sendMessageButton = document.getElementById('send-message');
    const chatMessages = document.getElementById('chat-messages');

    // Function to search exercises
    function searchExercises() {
      const query = searchInput.value.trim();
      if (!query) return;

      resultsContainer.innerHTML =
        '<div class="loading">Searching exercises...</div>';

      // Fetch exercises from our backend API
      fetch(`/dashboard/api/exercises/?query=${encodeURIComponent(query)}`)
        .then((response) => response.json())
        .then((data) => {
          resultsContainer.innerHTML = '';

          if (data.error) {
            resultsContainer.innerHTML = `<div class="error">Error: ${data.error}</div>`;
            return;
          }

          if (data.length === 0) {
            resultsContainer.innerHTML =
              '<div class="no-results">No exercises found. Try a different search term.</div>';
            return;
          }

          // Display exercises
          data.forEach((exercise) => {
            const card = document.createElement('div');
            card.className = 'exercise-card';

            let detailsHTML = '';
            if (exercise.bodyPart) {
              detailsHTML += `<span class="exercise-detail">Body Part: ${exercise.bodyPart}</span>`;
            }
            if (exercise.equipment) {
              detailsHTML += `<span class="exercise-detail">Equipment: ${exercise.equipment}</span>`;
            }
            if (exercise.target) {
              detailsHTML += `<span class="exercise-detail">Target: ${exercise.target}</span>`;
            }

            card.innerHTML = `
                        <div class="exercise-name">${exercise.name}</div>
                        <div class="exercise-details">${detailsHTML}</div>
                        ${
                          exercise.gifUrl
                            ? `<img src="${exercise.gifUrl}" alt="${exercise.name}" class="exercise-image">`
                            : ''
                        }
                    `;

            resultsContainer.appendChild(card);
          });
        })
        .catch((error) => {
          resultsContainer.innerHTML = `<div class="error">Error fetching exercises: ${error.message}</div>`;
        });
    }

    // Function to add message to chat
    function addMessage(content, isUser = false) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;

      const messageContent = document.createElement('div');
      messageContent.className = 'message-content';
      messageContent.textContent = content;

      messageDiv.appendChild(messageContent);
      chatMessages.appendChild(messageDiv);

      // Scroll to bottom of chat
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Function to add loading indicator
    function addLoadingIndicator() {
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message bot';
      messageDiv.id = 'loading-message';

      const messageContent = document.createElement('div');
      messageContent.className = 'message-content';

      const loadingSpinner = document.createElement('span');
      loadingSpinner.className = 'loading-indicator';

      const loadingText = document.createTextNode('Thinking...');

      messageContent.appendChild(loadingSpinner);
      messageContent.appendChild(loadingText);
      messageDiv.appendChild(messageContent);
      chatMessages.appendChild(messageDiv);

      // Scroll to bottom of chat
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Function to remove loading indicator
    function removeLoadingIndicator() {
      const loadingMessage = document.getElementById('loading-message');
      if (loadingMessage) {
        loadingMessage.remove();
      }
    }

    // Function to handle user messages
    function handleUserMessage() {
      const message = userMessageInput.value.trim();
      if (!message) return;

      // Add user message to chat
      addMessage(message, true);
      userMessageInput.value = '';

      // Show loading indicator
      addLoadingIndicator();

      // Send request to chatbot API
   